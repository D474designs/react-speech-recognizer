import React, { Component } from 'react'
import SpeechRecognizer from '../speechRecognizer'

const defaultCompare = (a, b) =>
  a.toLowerCase().trim() === b.toLowerCase().trim()

class WordDetector extends Component {
  constructor(props) {
    super(props)
    this.onResult = this.onResult.bind(this)
    this.state = {
      attempts: 0
    }
  }
  onResult(res = '') {
    const { attempts } = this.state
    const { word, onSuccess = () => {}, onFailure = () => {}, compare=defaultCompare } = this.props
    const incrementedAttempts = attempts + 1
    const success = compare(word, res)
    const cb = success
      ? onSuccess
      : onFailure
    cb(res, incrementedAttempts)

    this.setState({
      attempts: success
        ? 0
        : incrementedAttempts
    })
  }
  render() {
    return <SpeechRecognizer onResult={this.onResult} />
  }
}

export default WordDetector
